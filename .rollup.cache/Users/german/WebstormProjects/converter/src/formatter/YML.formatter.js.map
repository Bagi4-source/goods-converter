{"version":3,"file":"YML.formatter.js","sourceRoot":"","sources":["YML.formatter.ts"],"names":[],"mappings":"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","sourcesContent":["import {XMLBuilder} from \"fast-xml-parser\";\nimport {Product, Category} from \"../types\";\nimport {Formatter, FormatterOptions} from \"./formater.types\";\n\n\nexport class YMLFormatter implements Formatter {\n    builder = new XMLBuilder({ignoreAttributes: false, cdataPropName: '__cdata',});\n\n    async format(products: Product[], categories?: Category[], options?: FormatterOptions): Promise<string> {\n        const mappedCategories = {\n            category: categories?.map(cat => ({\n                \"@_id\": cat.id, \"@_parentId\": cat.parentId, \"#text\": cat.name\n            }))\n        };\n        const shopName = options?.shopName ?? \"ShopName\";\n        const companyName = options?.companyName ?? \"CompanyName\";\n        const offers = {\"offer\": products.map(this.getOffers)};\n        const result = {\n            \"?xml\": {\n                \"@_version\": '1.0',\n                \"@_encoding\": 'UTF-8',\n                \"@_standalone\": 'yes'\n            },\n            \"yml_catalog\": {\n                \"@_date\": new Date().toISOString().replace(/.\\d+Z/, ''),\n                \"shop\": {\n                    name: shopName,\n                    company: companyName,\n                    categories: mappedCategories,\n                    offers\n                }\n            }\n        };\n\n        return this.builder.build(result);\n    }\n\n    private getOffers(product: Product) {\n        const result = {\n            \"@_id\": product.variantId,\n            \"name\": product.title,\n            \"price\": product.price,\n            \"oldprice\": product.oldPrice,\n            \"purchase_price\": product.purchasePrice,\n            \"additional_expenses\": product.additionalExpenses,\n            \"cofinance_price\": product.cofinancePrice,\n            \"currencyId\": product.currency,\n            \"categoryId\": product.categoryId,\n            \"vendor\": product.vendor,\n            \"vendorCode\": product.vendorCode,\n            \"picture\": product.images,\n            \"video\": product.videos,\n            \"available\": product.available,\n            \"min-quantity\": product.minQuantity,\n            \"step-quantity\": product.stepQuantity,\n            \"param\": product.params?.map(param => ({\n                \"#text\": param.value,\n                \"@_name\": param.key\n            })),\n            \"description\": {\n                __cdata: product.description\n            },\n            \"country_of_origin\": product.countryOfOrigin,\n            \"barcode\": product.barcode,\n            \"vat\": product.vat,\n            \"count\": product.count,\n            \"set-ids\": product.tags?.join(\", \"),\n            \"adult\": product.adult,\n            \"downloadable\": product.downloadable,\n            \"period-of-validity-days\": product.validityPeriod,\n            \"comment-validity-days\": product.validityComment,\n            \"service-life-days\": product.serviceLifePeriod,\n            \"comment-life-days\": product.serviceLifeComment,\n            \"warranty-days\": product.warrantyPeriod,\n            \"comment-warranty\": product.warrantyComment,\n            \"manufacturer_warranty\": product.manufacturerWarranty,\n            \"certificate\": product.certificate,\n            \"url\": product.url,\n            \"weight\": product.weight,\n            \"dimensions\": product.dimensions,\n            \"boxCount\": product.boxCount,\n            \"disabled\": product.disabled,\n            \"age\": product.age && {\n                \"@_unit\": product.age.unit,\n                \"#text\": product.age.value,\n            },\n            \"tn-ved-codes\": product.codesTN?.length && {\n                \"tn-ved-code\": product.codesTN\n            }\n        };\n        if (product.parentId)\n            return {\n                ...result,\n                \"@_group_id\": product.parentId\n            };\n        return result;\n    }\n}\n\n"]}